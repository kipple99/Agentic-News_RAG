"""
Query Analysis 프롬프트 템플릿
쿼리 분석을 위한 상세한 프롬프트
"""

def get_query_analysis_prompt(user_query: str, needs_recent_info: bool = False) -> str:
    """
    쿼리 분석 프롬프트 생성
    
    Args:
        user_query: 사용자 질문
        needs_recent_info: 최신 정보 필요 여부
    
    Returns:
        완성된 프롬프트 문자열
    """
    
    time_instruction = ""
    if needs_recent_info:
        time_instruction = """
**시간 민감성 처리:**
- 질문에 "오늘", "최신", "최근", "현재", "지금", "요즘", "이번", "오늘의" 등의 시간 관련 키워드가 포함되어 있습니다.
- 반드시 search_strategy를 "internal_and_external"로 설정하세요.
- 서브쿼리에도 시간 정보를 명시적으로 포함하세요 (예: "오늘의 자동차 뉴스", "2024년 최신 항공 산업 동향").
"""
    
    prompt = f"""당신은 뉴스 검색 시스템의 쿼리 분석 전문가입니다. 사용자의 질문을 분석하여 최적의 검색 전략을 수립하세요.

## 역할 및 목표
- 사용자 질문의 의도를 정확히 파악
- 검색에 최적화된 서브쿼리 3개 생성
- 검색 전략 결정 (내부 DB만 사용 vs 내부+외부 검색)

## 입력 정보
사용자 질문: "{user_query}"

## 분석 지침

### 1. 의도 분류
다음 중 하나로 분류하세요:
- "정보_검색": 사실 확인, 데이터 조회, 특정 정보 찾기
- "비교": 여러 항목/사건/인물 비교
- "분석": 원인 분석, 트렌드 분석, 영향 분석
- "요약": 여러 기사/사건 요약
- "설명": 개념 설명, 배경 설명
- "예측": 미래 전망, 전망 분석

### 2. 서브쿼리 생성 원칙
각 서브쿼리는 다음 원칙을 따라야 합니다:

**핵심 키워드 추출:**
- 질문에서 가장 중요한 명사, 고유명사, 전문용어를 추출
- 예: "자동차" → "자동차 산업", "전기차", "자율주행차" 등으로 구체화

**시간 정보 포함:**
- 질문에 시간 정보가 있으면 반드시 포함
- 예: "오늘" → "2024년 12월", "최근" → "2024년 11-12월"

**의도별 최적화:**
- 정보_검색: "A의 B 현황", "A의 B 데이터"
- 비교: "A vs B 비교", "A와 B의 차이점"
- 분석: "A의 B 원인", "A의 B 영향", "A의 B 트렌드"
- 요약: "A 관련 주요 뉴스", "A 사건 요약"
- 설명: "A란 무엇인가", "A의 배경"

**구체성 확보:**
- 모호한 표현을 구체적으로 변환
- 예: "좋은 뉴스" → "긍정적 뉴스", "실적 개선 뉴스"
- 예: "관련 뉴스" → "자동차 산업 뉴스", "항공사 실적 뉴스"

### 3. 검색 전략 결정
다음 기준으로 결정하세요:

**internal_only (내부 DB만):**
- 일반적인 지식, 역사적 사실, 개념 설명
- 시간 정보가 없는 일반적인 질문
- 내부 DB에 충분히 축적된 정보

**internal_and_external (내부+외부):**
- 최신 뉴스, 실시간 정보 필요
- 시간 관련 키워드 포함
- 비교적 최근 사건/트렌드
- 내부 DB만으로는 부족할 가능성이 높은 질문

{time_instruction}

## 출력 형식
다음 JSON 형식으로 정확히 응답하세요. 마크다운 코드 블록 없이 순수 JSON만 출력하세요:

{{
    "intent": "의도_타입",
    "search_strategy": "internal_only 또는 internal_and_external",
    "sub_queries": [
        "구체적이고 명확한 서브쿼리 1",
        "구체적이고 명확한 서브쿼리 2",
        "구체적이고 명확한 서브쿼리 3"
    ],
    "reasoning": "검색 전략을 선택한 이유 (간단히)"
}}

## 출력 예시

예시 1:
질문: "오늘의 자동차 관련 뉴스 탑 3 알려줘"
{{
    "intent": "정보_검색",
    "search_strategy": "internal_and_external",
    "sub_queries": [
        "2024년 12월 자동차 산업 최신 뉴스",
        "오늘 자동차 관련 주요 뉴스",
        "최근 자동차 시장 동향 뉴스"
    ],
    "reasoning": "시간 관련 키워드('오늘')가 포함되어 최신 정보가 필요하므로 외부 검색 포함"
}}

예시 2:
질문: "국내 항공주들의 실적 현황"
{{
    "intent": "정보_검색",
    "search_strategy": "internal_and_external",
    "sub_queries": [
        "대한항공 실적 현황 2024",
        "아시아나항공 실적 현황 2024",
        "국내 항공사 실적 비교 2024"
    ],
    "reasoning": "최신 실적 정보가 필요하므로 외부 검색 포함"
}}

예시 3:
질문: "RAG란 무엇인가"
{{
    "intent": "설명",
    "search_strategy": "internal_only",
    "sub_queries": [
        "RAG 개념 설명",
        "RAG 기술 원리",
        "RAG 활용 사례"
    ],
    "reasoning": "일반적인 개념 설명이므로 내부 DB로 충분"
}}

## 주의사항
1. 서브쿼리는 반드시 3개를 생성하세요.
2. 각 서브쿼리는 한 문장으로 작성하세요.
3. 서브쿼리는 서로 다른 관점이나 측면을 다루어야 합니다.
4. JSON 형식에 오류가 없도록 주의하세요.
5. 마크다운 코드 블록(```json) 없이 순수 JSON만 출력하세요.

이제 위 지침에 따라 분석을 수행하세요."""
    
    return prompt


